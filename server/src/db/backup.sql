PRAGMA defer_foreign_keys=TRUE;
DROP TABLE IF EXISTS projects;
DROP TABLE IF EXISTS chats;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS deployments;
CREATE TABLE users (
  id TEXT PRIMARY KEY, 
  email_address TEXT, 
  metadata TEXT, 
  project_credits INTEGER default 10, -- free project credits, eg 10
  deployment_pm INTEGER default 100, -- deployment per month, eg 100
  token_balance INTEGER default 102400,
  deployment_limit_reset_at DATETIME default (DATETIME('now', '+30 days')),
  created_at DATETIME default CURRENT_TIMESTAMP,
  updated_at DATETIME default CURRENT_TIMESTAMP
);
INSERT INTO users VALUES('0a52a41e-3acb-49e1-bf62-03b8c3278b2e','mayureshchoudhary22@gmail.com','{"name":"Mayur"}',5,100,102400,'2025-01-23 18:21:42','2024-12-24 18:21:42','2024-12-24 18:21:42');
CREATE TABLE projects (
  project_id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  project_name TEXT, -- display name
  project_app_name TEXT, -- used as subdomain/slug eg. my-app 
  project_framework TEXT,
  project_description TEXT,
  project_status BOOLEAN default 0, -- 0 = not deployed, 1 = deployed
  project_type TEXT default 'private',
  project_size NUMERIC, -- in bytes
  entry_file_path TEXT, -- path to main entry file index.html
  is_temp BOOLEAN default 1, -- 0 = not temporary, 1 = temporary
  chat_id TEXT NOT NULL,
  created_at DATETIME default CURRENT_TIMESTAMP,
  updated_at DATETIME default CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
INSERT INTO projects VALUES('61ba4280-b826-40de-a2a6-0308edde02cb','0a52a41e-3acb-49e1-bf62-03b8c3278b2e','test','test-d6ab7da8','vite_react','test',1,'private',83219,'https://res.cloudinary.com/dkb6qr7ms/raw/upload/v1735065345/nimbuswave_projects/61ba4280-b826-40de-a2a6-0308edde02cb/index.html',0,'52d86986-2170-4d41-9eb7-bcb4d245a000','2024-12-24 18:21:56','2024-12-24 18:21:56');
INSERT INTO projects VALUES('1b7cc6ea-e17d-43fa-bb49-12ef54ccdde9','0a52a41e-3acb-49e1-bf62-03b8c3278b2e',NULL,NULL,NULL,NULL,0,'private',NULL,NULL,1,'a39098ca-ba1d-4e0d-ac8a-87e5b2d86752','2024-12-25 08:43:12','2024-12-25 08:43:12');
INSERT INTO projects VALUES('734b840f-fa2d-421b-851e-34a5761cf4cc','0a52a41e-3acb-49e1-bf62-03b8c3278b2e','React router app','react-router-app-9593f172','vite_react','Its a basic react router implementation',1,'private',146786,'https://res.cloudinary.com/dkb6qr7ms/raw/upload/v1735116991/nimbuswave_projects/734b840f-fa2d-421b-851e-34a5761cf4cc/index.html',0,'592ce990-50e7-4239-8082-d631e62b4f4e','2024-12-25 08:48:26','2024-12-25 08:48:26');
INSERT INTO projects VALUES('0424e88e-6d74-45b2-a543-6cf093aebed0','0a52a41e-3acb-49e1-bf62-03b8c3278b2e',NULL,NULL,NULL,NULL,0,'private',NULL,NULL,1,'147c0675-af24-4058-b559-bfa3b94a5bd7','2024-12-25 09:33:15','2024-12-25 09:33:15');
INSERT INTO projects VALUES('28fa25ae-63f4-4668-9941-428d2bc54a71','0a52a41e-3acb-49e1-bf62-03b8c3278b2e',NULL,NULL,NULL,NULL,0,'private',NULL,NULL,1,'6570b89e-62ca-47bd-9397-1e1045b2c3e7','2024-12-25 09:42:34','2024-12-25 09:42:34');
CREATE TABLE deployments (
  deployment_id TEXT PRIMARY KEY,
  project_id TEXT NOT NULL,
  deployment_app_name TEXT, -- used as subdomain/slug eg. my-app
  deployment_status BOOLEAN default 0, -- 0 = failed/error, 1 = deployed
  deployment_url TEXT,
  deployment_logs TEXT,
  deployment_size NUMERIC, -- in bytes
  time_taken NUMERIC, -- in milliseconds
  created_at DATETIME default CURRENT_TIMESTAMP,
  updated_at DATETIME default CURRENT_TIMESTAMP,
  FOREIGN KEY (project_id) REFERENCES projects(project_id) ON DELETE CASCADE
);
INSERT INTO deployments VALUES('b995cece-059c-432f-a162-5712e63cb897','61ba4280-b826-40de-a2a6-0308edde02cb',NULL,1,NULL,replace('1,735,065,335,746: DeploymentService initialized for project 61ba4280-b826-40de-a2a6-0308edde02cb\n1,735,065,335,875: Unzipping project files...\n1,735,065,335,896: Unzipping successful\n1,735,065,335,897: Processing project files...\n1,735,065,335,897: Skipping file \n1,735,065,335,897: Skipping file assets/\n1,735,065,338,021: Processed file assets/favicon-CTel0fhF.svg successfully.\n1,735,065,338,777: Processed file assets/index-CGjyO6zs.css successfully.\n1,735,065,340,621: Processed file assets/index-CU2wvwdd.js successfully.\n1,735,065,342,263: Processed file favicon.svg successfully.\n1,735,065,342,264: Skipping file index.html\n1,735,065,342,905: Processed file logo.png successfully.\n1,735,065,345,408: Processed file logo.svg successfully.\n1,735,065,345,408: Successfully processed all the files.\n1,735,065,345,409: Processing index.html...\n1,735,065,345,986: Processed index.html successfully.\n1,735,065,345,987: Finalizing deployment...\n1,735,065,345,987: Deployment finalized.\n','\n',char(10)),83219,10242,'2024-12-24 18:35:46','2024-12-24 18:35:46');
INSERT INTO deployments VALUES('907a64f3-d662-4d36-b4af-524fea7c6fa8','734b840f-fa2d-421b-851e-34a5761cf4cc',NULL,1,NULL,replace('1,735,116,687,791: DeploymentService initialized for project 734b840f-fa2d-421b-851e-34a5761cf4cc\n1,735,116,688,338: Unzipping project files...\n1,735,116,688,483: Unzipping successful\n1,735,116,688,484: Processing project files...\n1,735,116,688,484: Skipping file \n1,735,116,688,484: Skipping file assets/\n1,735,116,690,869: Processed file assets/favicon-CTel0fhF.svg successfully.\n1,735,116,691,354: Processed file assets/index-CGjyO6zs.css successfully.\n1,735,116,692,420: Processed file assets/index-CU2wvwdd.js successfully.\n1,735,116,693,960: Processed file favicon.svg successfully.\n1,735,116,693,960: Skipping file index.html\n1,735,116,694,589: Processed file logo.png successfully.\n1,735,116,696,080: Processed file logo.svg successfully.\n1,735,116,696,080: Successfully processed all the files.\n1,735,116,696,080: Processing index.html...\n1,735,116,696,685: Processed index.html successfully.\n1,735,116,696,685: Finalizing deployment...\n1,735,116,696,685: Deployment finalized.\n','\n',char(10)),83219,8895,'2024-12-25 08:51:36','2024-12-25 08:51:36');
INSERT INTO deployments VALUES('baa46fb2-a6a8-4de5-ae30-eb8c9e0d031c','734b840f-fa2d-421b-851e-34a5761cf4cc',NULL,1,NULL,replace('1,735,116,787,034: DeploymentService initialized for project 734b840f-fa2d-421b-851e-34a5761cf4cc\n1,735,116,787,034: Unzipping project files...\n1,735,116,787,063: Unzipping successful\n1,735,116,787,063: Processing project files...\n1,735,116,787,064: Skipping file \n1,735,116,787,064: Skipping file assets/\n1,735,116,788,705: Processed file assets/index-BRbh_Yes.css successfully.\n1,735,116,789,853: Processed file assets/index-ISUVI1R-.js successfully.\n1,735,116,789,854: Skipping file index.html\n1,735,116,790,317: Processed file vite.svg successfully.\n1,735,116,790,317: Successfully processed all the files.\n1,735,116,790,317: Processing index.html...\n1,735,116,790,621: Processed index.html successfully.\n1,735,116,790,621: Finalizing deployment...\n1,735,116,790,621: Deployment finalized.\n','\n',char(10)),76028,3587,'2024-12-25 08:53:10','2024-12-25 08:53:10');
INSERT INTO deployments VALUES('6d64f7e7-a71c-430d-b90f-a97d9aacd31f','734b840f-fa2d-421b-851e-34a5761cf4cc',NULL,1,NULL,replace('1,735,116,989,301: DeploymentService initialized for project 734b840f-fa2d-421b-851e-34a5761cf4cc\n1,735,116,989,301: Unzipping project files...\n1,735,116,989,304: Unzipping successful\n1,735,116,989,304: Processing project files...\n1,735,116,989,304: Skipping file \n1,735,116,989,305: Skipping file assets/\n1,735,116,990,734: Processed file assets/index-BRbh_Yes.css successfully.\n1,735,116,991,989: Processed file assets/index-ISUVI1R-.js successfully.\n1,735,116,991,990: Skipping file index.html\n1,735,116,992,453: Processed file vite.svg successfully.\n1,735,116,992,453: Successfully processed all the files.\n1,735,116,992,453: Processing index.html...\n1,735,116,993,055: Processed index.html successfully.\n1,735,116,993,055: Finalizing deployment...\n1,735,116,993,055: Deployment finalized.\n','\n',char(10)),76028,3754,'2024-12-25 08:56:33','2024-12-25 08:56:33');
INSERT INTO deployments VALUES('5725503a-a6d1-43a4-96a1-3cdbaee5a0f3','734b840f-fa2d-421b-851e-34a5761cf4cc',NULL,1,NULL,replace('1,735,119,802,263: DeploymentService initialized for project 734b840f-fa2d-421b-851e-34a5761cf4cc\n1,735,119,802,362: Unzipping project files...\n1,735,119,802,382: Unzipping successful\n1,735,119,802,383: Processing project files...\n1,735,119,802,384: Skipping file \n1,735,119,802,384: Skipping file assets/\n1,735,119,803,632: Processed file assets/index-BRbh_Yes.css successfully.\n1,735,119,804,834: Processed file assets/index-ISUVI1R-.js successfully.\n1,735,119,804,835: Skipping file index.html\n1,735,119,805,309: Processed file vite.svg successfully.\n1,735,119,806,814: Processed file assets/index-CGt_IpU6.js successfully.\n1,735,119,806,814: Successfully processed all the files.\n1,735,119,806,815: Processing index.html...\n1,735,119,807,213: Processed index.html successfully.\n1,735,119,807,214: Finalizing deployment...\n1,735,119,807,214: Deployment finalized.\n','\n',char(10)),146786,4951,'2024-12-25 09:43:27','2024-12-25 09:43:27');
CREATE TABLE chats (
  chat_id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  project_id TEXT NOT NULL,
  chat_context TEXT,
  tokens_consumed INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (project_id) REFERENCES projects(project_id) ON DELETE CASCADE
);
INSERT INTO chats VALUES('52d86986-2170-4d41-9eb7-bcb4d245a000','0a52a41e-3acb-49e1-bf62-03b8c3278b2e','61ba4280-b826-40de-a2a6-0308edde02cb','[{"role":"user","content":"i have uploaded my dist folder"},{"role":"assistant","content":"Great! To get started, could you please tell me the name of your project?"},{"role":"user","content":"Cheeky AI"},{"role":"assistant","content":"What framework did you use to build your project?"},{"role":"user","content":"I used Vite react"},{"role":"assistant","content":"Thanks! You said you used Vite React."},{"role":"user","content":"yes right"},{"role":"assistant","content":"Perfect! What is a brief description of your project?"},{"role":"user","content":"Its a funky ai chatbot"},{"role":"assistant","content":"That''s awesome! Do you want to set a deployment status for your project while we''re setting everything up?"},{"role":"user","content":"nope"},{"role":"assistant","content":"Noted. Let me initiate the deployment process now."},{"role":"user","content":"re deploy"},{"role":"assistant","content":"Okay, let''s trigger a redeployment. Are you sure you want to overwrite the existing deployment with the latest changes?"},{"role":"user","content":"yes i am sure"},{"role":"assistant","content":"Redeployment initiated. Please wait while your project is updated on the edge network."},{"role":"user","content":"one more time"},{"role":"assistant","content":"You''ve requested a redeployment. Just to confirm, are you sure you want to overwrite the existing deployment with the latest changes?"},{"role":"user","content":"yes"},{"role":"assistant","content":"Redeployment initiated. Please wait while your project is updated on the edge network."},{"role":"user","content":"i am sure re deploy"},{"role":"assistant","content":"Redeployment initiated. Please wait while your project is updated on the edge network."},{"role":"user","content":"i am sure re deploy"},{"role":"assistant","content":"Redeployment initiated. Please wait while your project is updated on the edge network."}]',0,'2024-12-24 18:21:56','2024-12-24 18:21:56');
INSERT INTO chats VALUES('a39098ca-ba1d-4e0d-ac8a-87e5b2d86752','0a52a41e-3acb-49e1-bf62-03b8c3278b2e','1b7cc6ea-e17d-43fa-bb49-12ef54ccdde9',NULL,0,'2024-12-25 08:43:12','2024-12-25 08:43:12');
INSERT INTO chats VALUES('592ce990-50e7-4239-8082-d631e62b4f4e','0a52a41e-3acb-49e1-bf62-03b8c3278b2e','734b840f-fa2d-421b-851e-34a5761cf4cc','[{"role":"user","content":"hello"},{"role":"assistant","content":"Hi! Welcome to NimbusWave. Let''s deploy your web app. What''s the name of your project?"},{"role":"user","content":"React router app"},{"role":"assistant","content":"Great! What framework are you using?"},{"role":"user","content":"save name "},{"role":"assistant","content":"What framework are you using?"},{"role":"user","content":"save project name"},{"role":"assistant","content":"Okay, your project name is React router app. What framework are you using?"},{"role":"user","content":"you havn''t saved it"},{"role":"assistant","content":"Please tell me the framework you are using."},{"role":"user","content":"Vite react"},{"role":"assistant","content":"Perfect! Is there a description you''d like to add for your project?"},{"role":"user","content":"you are not using the tools are you?"},{"role":"assistant","content":"I apologize for the confusion. I''m still under development and learning to use the tools correctly. "},{"role":"user","content":"i used framework Vite react"},{"role":"assistant","content":"Thanks for clarifying! You''re using Vite React.  saving project framework"},{"role":"user","content":"yess"},{"role":"assistant","content":"Great!  Do you have a short description for your project?"},{"role":"user","content":"Its a basic react router implementation"},{"role":"assistant","content":"Thats great! I''ve saved ''Its a basic react router implementation''  as your project description. "},{"role":"user","content":"okay"},{"role":"assistant","content":"Fantastic! Everything is set. I''m going to  begin the deployment process."},{"role":"user","content":"yes start deployment"},{"role":"assistant","content":"Starting your deployment! Please await confirmation."},{"role":"user","content":"re deploy i made changes"},{"role":"assistant","content":"Okay, let''s re-deploy!  Just  make sure to upload the updated /dist or /build folder."},{"role":"user","content":"yes sure"},{"role":"assistant","content":"Deployment initiated!"},{"role":"user","content":"okay"},{"role":"assistant","content":"Deployment complete!"},{"role":"user","content":"no deployment was initiated"},{"role":"assistant","content":"My apologies, it seems I didn''t initiate the deployment correctly.  Let me try again. "},{"role":"user","content":"re deploy"},{"role":"assistant","content":"Deployment initiated! \\n"},{"role":"user","content":"re deploy"},{"role":"assistant","content":"re-deployment initiated"}]',0,'2024-12-25 08:48:26','2024-12-25 08:48:26');
INSERT INTO chats VALUES('147c0675-af24-4058-b559-bfa3b94a5bd7','0a52a41e-3acb-49e1-bf62-03b8c3278b2e','0424e88e-6d74-45b2-a543-6cf093aebed0','[{"role":"user","content":"helloo man"},{"role":"assistant","content":"Hello, welcome to NimbusWave. I''ll guide you through the deployment process of your JavaScript/TypeScript web app. Can you please provide the name of your project?"},{"role":"user","content":"Its hotel management"},{"role":"assistant","content":"Thanks for providing the project name. I have saved it as ''hotel management''."},{"role":"user","content":"okaay "},{"role":"assistant","content":"What framework are you using for your ''hotel management'' project? We support Vite React, React, and Vue."},{"role":"user","content":"Vite react"},{"role":"assistant","content":"Framework saved as Vite React"},{"role":"user","content":"yes"},{"role":"assistant","content":"Framework saved as Vite React. Now, please provide a brief description of your project."},{"role":"user","content":"its a hotel management app "},{"role":"assistant","content":"Description saved as ''hotel management app''. Initializing deployment next."},{"role":"user","content":"yes do it"},{"role":"assistant","content":"Deployment initialized"},{"role":"user","content":"Error: Invalid file type, only zip files are allowed"},{"role":"assistant","content":"Please upload your project as a zip file"},{"role":"user","content":"done"},{"role":"assistant","content":"zip file uploaded, starting deployment on global edge network"},{"role":"user","content":"re deploy"},{"role":"assistant","content":"Re-deploying your project"},{"role":"user","content":"try again"},{"role":"assistant","content":"Re-deployment in progress"},{"role":"user","content":"re deploy"},{"role":"assistant","content":"Re-deploying your project"}]',0,'2024-12-25 09:33:15','2024-12-25 09:33:15');
INSERT INTO chats VALUES('6570b89e-62ca-47bd-9397-1e1045b2c3e7','0a52a41e-3acb-49e1-bf62-03b8c3278b2e','28fa25ae-63f4-4668-9941-428d2bc54a71',NULL,0,'2024-12-25 09:42:34','2024-12-25 09:42:34');